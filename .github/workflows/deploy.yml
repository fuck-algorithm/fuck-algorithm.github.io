name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

# 设置权限
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v3

      - name: Setup Node.js 📦
        uses: actions/setup-node@v3
        with:
          node-version: '16'
          cache: 'npm'
          
      - name: Install Dependencies 🔧
        run: |
          npm install
          
      - name: Debug Build Environment 🔍
        run: |
          echo "Node version: $(node -v)"
          echo "NPM version: $(npm -v)"
          echo "Directory structure:"
          ls -la

      - name: Create Build Directory 📁
        run: |
          # 创建构建目录
          mkdir -p dist
          
          # 复制公共资源
          cp -r public/* dist/
          
          # 创建CSS文件
          cat > dist/styles.css << 'EOL'
          body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f7;
            color: #333;
            line-height: 1.5;
          }
          
          .App {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
          }
          
          .App-header {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
          }
          
          .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto;
            height: 70px;
          }
          
          .logo h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #1e1e2e;
          }
          
          .nav-links {
            display: flex;
            gap: 20px;
          }
          
          .nav-links a {
            text-decoration: none;
            color: #555;
            font-weight: 500;
            transition: color 0.3s;
          }
          
          .nav-links a:hover {
            color: #61dafb;
          }
          
          main {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
          }
          
          footer {
            background-color: #1e1e2e;
            color: white;
            padding: 40px 20px;
          }
          
          .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
          }
          
          .footer-links {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
          }
          
          .footer-links a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
          }
          
          .footer-links a:hover {
            opacity: 0.8;
          }
          
          /* 首页样式 */
          .hero {
            padding: 80px 20px;
            text-align: center;
            background-color: #1e1e2e;
            color: white;
            margin: -20px -20px 0;
          }
          
          .hero-content h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
          }
          
          .slogan {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.9;
          }
          
          .cta-button {
            display: inline-block;
            background-color: #61dafb;
            color: #1e1e2e;
            padding: 12px 24px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
          }
          
          .cta-button:hover {
            background-color: #4fa8d8;
          }
          
          .products, .problems, .about {
            padding: 60px 0;
          }
          
          .products h2, .problems h2, .about h2 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            color: #1e1e2e;
          }
          
          .product-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
          }
          
          .product-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
          }
          
          .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
          }
          
          .product-card h3 {
            margin-top: 0;
            color: #1e1e2e;
          }
          
          .product-link {
            display: inline-block;
            margin-top: 20px;
            background-color: #1e1e2e;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
          }
          
          .product-link:hover {
            background-color: #333344;
          }
          
          .about p {
            max-width: 800px;
            margin: 0 auto 20px;
            text-align: center;
            font-size: 1.1rem;
            line-height: 1.6;
          }
          
          /* 题解列表样式 */
          .problem-list {
            padding: 40px 0;
          }
          
          .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
          }
          
          .filters {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
          }
          
          .filter-label {
            margin-right: 10px;
            font-weight: 500;
          }
          
          .filter-btn {
            border: none;
            background-color: #f0f0f0;
            color: #555;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
          }
          
          .filter-btn:hover, .filter-btn.active {
            background-color: #1e1e2e;
            color: white;
          }
          
          .filter-btn.easy {
            border: 1px solid #4caf50;
          }
          
          .filter-btn.medium {
            border: 1px solid #ff9800;
          }
          
          .filter-btn.hard {
            border: 1px solid #f44336;
          }
          
          .problem-table-container {
            max-width: 100%;
            overflow-x: auto;
          }
          
          .problem-table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
          }
          
          .problem-table th, .problem-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
          }
          
          .problem-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #1e1e2e;
          }
          
          .problem-table tr:last-child td {
            border-bottom: none;
          }
          
          .problem-table tr:hover {
            background-color: #f5f5f7;
          }
          
          .difficulty-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
          }
          
          .difficulty-tag.easy {
            background-color: #e8f5e9;
            color: #4caf50;
          }
          
          .difficulty-tag.medium {
            background-color: #fff3e0;
            color: #ff9800;
          }
          
          .difficulty-tag.hard {
            background-color: #ffebee;
            color: #f44336;
          }
          
          .view-btn {
            display: inline-block;
            background-color: #1e1e2e;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            transition: background-color 0.3s;
          }
          
          .view-btn:hover {
            background-color: #333344;
          }
          
          /* 404页面样式 */
          .not-found {
            text-align: center;
            padding: 100px 20px;
          }
          
          .not-found h1 {
            font-size: 120px;
            margin: 0;
            color: #1e1e2e;
            line-height: 1;
          }
          
          .not-found h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #1e1e2e;
          }
          
          .not-found p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #666;
          }
          EOL
          
          # 创建主JavaScript文件
          cat > dist/app.js << 'EOL'
          document.addEventListener('DOMContentLoaded', function() {
            // 处理页面内容
            displayContent();
          });
          
          function displayContent() {
            const root = document.getElementById('root');
            
            if (!root) {
              console.error('未找到root元素');
              return;
            }
            
            // 创建App容器
            const app = document.createElement('div');
            app.className = 'App';
            
            // 添加页面结构
            app.innerHTML = `
              <header class="App-header">
                <nav class="navbar">
                  <div class="logo">
                    <h1>Fuck Algorithm</h1>
                  </div>
                  <div class="nav-links">
                    <a href="#">首页</a>
                    <a href="#products">产品</a>
                    <a href="#problems">题解</a>
                    <a href="#about">关于我们</a>
                    <a href="https://github.com/fuck-algorithm" target="_blank" rel="noopener noreferrer">GitHub</a>
                  </div>
                </nav>
              </header>
              
              <main>
                <section class="hero">
                  <div class="hero-content">
                    <h1>Fuck Algorithm</h1>
                    <p class="slogan">把一天能理解的知识，缩短到一个小时</p>
                    <a href="#products" class="cta-button">查看我们的产品</a>
                  </div>
                </section>
                
                <section id="products" class="products">
                  <h2>我们的产品</h2>
                  <div class="product-cards">
                    <div class="product-card">
                      <h3>LeetCode Hot 100</h3>
                      <p>LeetCode最热门的100道算法题目解析</p>
                      <a href="https://fuck-algorithm.github.io/leetcode-hot-100/" target="_blank" rel="noopener noreferrer" class="product-link">
                        立即访问
                      </a>
                    </div>
                  </div>
                </section>
                
                <section id="problems" class="problems">
                  <div class="problem-list">
                    <h2>所有算法题解</h2>
                    <p class="subtitle">按题号排序的所有题解列表</p>
                    
                    <div class="filters">
                      <span class="filter-label">难度筛选:</span>
                      <button class="filter-btn active">全部</button>
                      <button class="filter-btn easy">简单</button>
                      <button class="filter-btn medium">中等</button>
                      <button class="filter-btn hard">困难</button>
                    </div>
                    
                    <div class="problem-table-container">
                      <table class="problem-table">
                        <thead>
                          <tr>
                            <th>题号</th>
                            <th>标题</th>
                            <th>难度</th>
                            <th>操作</th>
                          </tr>
                        </thead>
                        <tbody id="problems-tbody"></tbody>
                      </table>
                    </div>
                  </div>
                </section>
                
                <section id="about" class="about">
                  <h2>关于我们</h2>
                  <p>我们致力于提供简洁明了的算法解析，帮助开发者快速理解和掌握常见算法问题。</p>
                  <p>我们的目标是让复杂的算法变得简单易懂，将需要一天才能理解的知识浓缩到一小时内。</p>
                </section>
              </main>
              
              <footer>
                <div class="footer-content">
                  <div class="footer-links">
                    <a href="https://github.com/fuck-algorithm" target="_blank" rel="noopener noreferrer">GitHub</a>
                    <a href="#products">产品</a>
                    <a href="#problems">题解</a>
                    <a href="#about">关于我们</a>
                  </div>
                  <p>© ${new Date().getFullYear()} Fuck Algorithm. 保留所有权利。</p>
                </div>
              </footer>
            `;
            
            // 添加到DOM
            root.appendChild(app);
            
            // 添加题目数据
            const problems = [
              {
                id: 20,
                title: '有效的括号',
                url: 'https://fuck-algorithm.github.io/leetcode-20-valid-parentheses/',
                difficulty: 'easy'
              },
              {
                id: 94,
                title: '二叉树的中序遍历',
                url: 'https://fuck-algorithm.github.io/leetcode-94-binary-tree-inorder-traversal/',
                difficulty: 'medium'
              },
              {
                id: 136,
                title: '只出现一次的数字',
                url: 'https://fuck-algorithm.github.io/leetcode-136-single-number/',
                difficulty: 'easy'
              },
              {
                id: 160,
                title: '相交链表',
                url: 'https://fuck-algorithm.github.io/leetcode-160-intersection-of-two-linked-lists/',
                difficulty: 'easy'
              },
              {
                id: 169,
                title: '多数元素',
                url: 'https://fuck-algorithm.github.io/leetcode-169-majority-element/',
                difficulty: 'easy'
              },
              {
                id: 200,
                title: '岛屿数量',
                url: 'https://fuck-algorithm.github.io/leetcode-200-number-of-islands/',
                difficulty: 'medium'
              },
              {
                id: 283,
                title: '移动零',
                url: 'https://fuck-algorithm.github.io/leetcode-283-move-zeroes/',
                difficulty: 'easy'
              },
              {
                id: 461,
                title: '汉明距离',
                url: 'https://fuck-algorithm.github.io/leetcode-461-hamming-distance/',
                difficulty: 'easy'
              }
            ];
            
            const tbody = document.getElementById('problems-tbody');
            if (tbody) {
              problems.forEach(problem => {
                const tr = document.createElement('tr');
                tr.className = `difficulty-${problem.difficulty}`;
                
                const difficultyText = problem.difficulty === 'easy' ? '简单' : 
                                       problem.difficulty === 'medium' ? '中等' : '困难';
                
                tr.innerHTML = `
                  <td>${problem.id}</td>
                  <td>${problem.title}</td>
                  <td>
                    <span class="difficulty-tag ${problem.difficulty}">
                      ${difficultyText}
                    </span>
                  </td>
                  <td>
                    <a href="${problem.url}" target="_blank" rel="noopener noreferrer" class="view-btn">
                      查看解析
                    </a>
                  </td>
                `;
                
                tbody.appendChild(tr);
              });
            }
            
            // 处理筛选按钮
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
              button.addEventListener('click', function() {
                // 移除所有按钮的active类
                filterButtons.forEach(btn => btn.classList.remove('active'));
                
                // 添加当前按钮的active类
                this.classList.add('active');
                
                // 获取选择的难度
                const difficulty = this.classList.contains('easy') ? 'easy' : 
                                  this.classList.contains('medium') ? 'medium' : 
                                  this.classList.contains('hard') ? 'hard' : 'all';
                
                // 筛选题目
                const rows = document.querySelectorAll('.problem-table tbody tr');
                rows.forEach(row => {
                  if (difficulty === 'all' || row.classList.contains(`difficulty-${difficulty}`)) {
                    row.style.display = '';
                  } else {
                    row.style.display = 'none';
                  }
                });
              });
            });
          }
          EOL
          
          # 更新index.html以引用新的资源文件
          sed -i 's|</head>|<link rel="stylesheet" href="./styles.css"></head>|' dist/index.html
          sed -i 's|</body>|<script src="./app.js"></script></body>|' dist/index.html
          
          # 创建404页面
          cp dist/index.html dist/404.html
          
          echo "构建目录内容:"
          ls -la dist
        
      - name: Deploy to GitHub Pages 🚀
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist
          branch: gh-pages
          clean: true
          token: ${{ secrets.GITHUB_TOKEN }} 